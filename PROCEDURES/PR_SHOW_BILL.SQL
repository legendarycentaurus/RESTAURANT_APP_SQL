DELIMITER $$

CREATE  PROCEDURE `PR_SHOW_BILL`(IN I_ORDER_ID INT,OUT MESSAGE TEXT,IN I_SEATNO INT)
BEGIN
DECLARE L_TOTAL INT;
	IF NOT EXISTS(SELECT ORDER_NO FROM order_details WHERE ORDER_NO=I_ORDER_ID) THEN
	SET MESSAGE='NO ORDERS HAVE BEEN PLACED SO NO BILL';
	ELSEIF EXISTS(SELECT ORDER_NO FROM order_details WHERE ORDER_NO=I_ORDER_ID AND STATUS<>'CANCELED') THEN
	SELECT SUM(PRICE) INTO L_TOTAL FROM order_details WHERE ORDER_NO=I_ORDER_ID;
	UPDATE ORDER_STATUS  SET TOTAL_PRICE=L_TOTAL WHERE ID=I_ORDER_ID;
	UPDATE HOTEL_SEATS SET STATUS=0 WHERE SEAT_NO=I_SEATNO;
	SELECT ID,STATUS,TOTAL_PRICE FROM ORDER_STATUS WHERE ID=I_ORDER_ID;
	ELSE SET MESSAGE='INVALID ORDERID';
	END IF; 
    END$$

DELIMITER ;